<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Vendas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        input {
            width: 100%;
            border: none;
            text-align: center;
            background: transparent;
        }
        .btn {
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            color: white;
            margin: 2px;
        }
        .btn-edit { background-color: #007bff; }
        .btn-edit:hover { background-color: #0056b3; }
        .btn-delete { background-color: #dc3545; }
        .btn-delete:hover { background-color: #a71d2a; }
        button#addCliente {
            margin-top: 10px;
            padding: 8px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button#addCliente:hover {
            background-color: #218838;
        }
        .moeda {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: #333;
        }
        .comprovante-container img {
            max-width: 50px;
            max-height: 50px;
            cursor: pointer;
        }
        .comprovante-container a {
            text-decoration: none;
            color: blue;
        }
        .checkbox-cell {
            font-weight: bold;
            padding: 10px;
        }
        .nao { background-color: red; color: white; }
        .sim { background-color: yellow; color: black; }
    </style>
</head>
<body>

    <h2>Planilha de Vendas</h2>
    <button id="addCliente">Adicionar Cliente</button>

    <table id="tabela-vendas">
        <thead>
            <tr>
                <th>Nome do Cliente</th>
                <th>Usuário</th>
                <th>Data de Vencimento</th>
                <th>Dias Restantes</th>
                <th>Valor Pago</th>
                <th>Plataforma</th>
                <th>Comprovante</th>
                <th>Observação</th>
                <th>Renovação</th>
                <th>Remarketing</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody> 
        </tbody>
    </table>

    <script>
        let vendas = JSON.parse(localStorage.getItem("vendas")) || [];

        function salvarNoLocalStorage() {
            localStorage.setItem("vendas", JSON.stringify(vendas));
        }

        function calcularDiasRestantes(dataVencimento) {
            const hoje = new Date();
            const vencimento = new Date(dataVencimento);
            const diferenca = vencimento - hoje;
            return Math.ceil(diferenca / (1000 * 60 * 60 * 24));
        }

        function atualizarTabela() {
            const tbody = document.querySelector("#tabela-vendas tbody");
            tbody.innerHTML = "";

            vendas.forEach((venda, index) => {
                let tr = document.createElement("tr");

                tr.innerHTML = `
                    <td><input type="text" value="${venda.nome}" data-index="${index}" data-field="nome" disabled></td>
                    <td><input type="text" value="${venda.usuario}" data-index="${index}" data-field="usuario" disabled></td>
                    <td><input type="date" value="${venda.vencimento}" data-index="${index}" data-field="vencimento" disabled></td>
                    <td>${calcularDiasRestantes(venda.vencimento)}</td>
                    <td style="position: relative;">
                        <span class="moeda">R$</span>
                        <input type="number" class="campo-moeda" value="${venda.valor}" data-index="${index}" data-field="valor" disabled>
                    </td>
                    <td><input type="text" value="${venda.plataforma}" data-index="${index}" data-field="plataforma" disabled></td>
                    <td class="comprovante-container">
                        ${venda.comprovante ? 
                            (venda.comprovante.includes("data:image") ? 
                                `<img src="${venda.comprovante}" alt="Comprovante" onclick="window.open('${venda.comprovante}', '_blank')">` 
                                : `<a href="${venda.comprovante}" target="_blank">Baixar PDF</a>`
                            ) 
                            : `<input type="file" accept="image/*,application/pdf" onchange="uploadComprovante(event, ${index})">`}
                    </td>
                    <td><input type="text" value="${venda.observacao}" data-index="${index}" data-field="observacao" disabled></td>
                    <td class="checkbox-cell ${venda.renovacao ? 'sim' : 'nao'}" onclick="toggleCheckbox(${index}, 'renovacao')">${venda.renovacao ? 'Sim' : 'Não'}</td>
                    <td class="checkbox-cell ${venda.remarketing ? 'sim' : 'nao'}" onclick="toggleCheckbox(${index}, 'remarketing')">${venda.remarketing ? 'Sim' : 'Não'}</td>
                    <td>
                        <button class="btn btn-edit" onclick="editarLinha(${index}, this)">Editar</button>
                        <button class="btn btn-delete" onclick="excluirLinha(${index})">Excluir</button>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        function editarLinha(index, botao) {
            let inputs = document.querySelectorAll(`[data-index="${index}"]`);
            let editando = inputs[0].disabled === false;

            inputs.forEach(input => input.disabled = editando);
            botao.textContent = editando ? "Editar" : "Salvar";

            if (editando) {
                vendas[index].nome = inputs[0].value;
                vendas[index].usuario = inputs[1].value;
                vendas[index].vencimento = inputs[2].value;
                vendas[index].valor = inputs[3].value;
                vendas[index].plataforma = inputs[4].value;
                vendas[index].observacao = inputs[5].value;
                salvarNoLocalStorage();
            }
        }

        function excluirLinha(index) {
            if (confirm("Tem certeza que deseja excluir este cliente?")) {
                vendas.splice(index, 1);
                salvarNoLocalStorage();
                atualizarTabela();
            }
        }

        function toggleCheckbox(index, campo) {
            vendas[index][campo] = !vendas[index][campo];
            salvarNoLocalStorage();
            atualizarTabela();
        }

        document.getElementById("addCliente").addEventListener("click", () => {
            let novoCliente = {
                nome: "",
                usuario: "",
                vencimento: new Date().toISOString().split("T")[0],
                valor: 0,
                plataforma: "",
                comprovante: "",
                observacao: "",
                renovacao: false,
                remarketing: false
            };
            vendas.push(novoCliente);
            salvarNoLocalStorage();
            atualizarTabela();
        });

        atualizarTabela();
    </script>

</body>
</html>
